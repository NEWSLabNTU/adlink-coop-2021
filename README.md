# Zenoh Performance Tests

This is a repository that contains the codes to test the performance of [Zenoh](https://zenoh.io/).  
Currently (2021/12/21), the Zenoh version tested is 0.5.0-beta9.

We use [psrecord](https://github.com/astrofrog/psrecord) to record the CPU and memory usage of the test program.

## Build

To build the program, please make sure you have [Rust](https://www.rust-lang.org/) installed.

Run the following command to build release version:
```bash
cargo build --release
```

If you need to parse the log file generated by [psrecord](https://github.com/astrofrog/psrecord), please build the `usage-parser` crate with the following command:
```bash
cd usage-parser
cargo build --release
```

## Usage

Make sure you have build all the programs.

To run the test, simply run:
```bash
./target/release/zenoh_performance_test
```

To parse the log file generated by [psrecord](https://github.com/astrofrog/psrecord), run:
```bash
./target/release/usage-parser -i <path to log file>
```

If the current `task_worker_1` function cannot fulfill your tests or the CLI input lacks the parameters you need, feel free to create a new async function or add members in the `Cli` structure. 
Please do not modify the `main` function.

## Development

For people who are running experiment testings with this program. You may store the psrecord generated files under the `experiment-results` folder which is ignored in `.gitignore` file.

## Todo Lists
- [x] Basic put/sub worker implementation
- [x] Basic testing function with simple output msgs.
- [x] Add parser for [psrecord](https://github.com/astrofrog/psrecord) output
- [x] Add support for multiple subscribe workers
- [x] Implement CLI for parameter configuration   
- [x] Separate building blocks from main.rs 
- [ ] Parallelize the peers by using all cores.
- [ ] Add adjustable payload size for `test_worker_1`.
- [ ] Add support for multiple machines